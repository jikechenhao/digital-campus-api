# 代码规范

----

version:0.0.1

author:李志强

基本确定规范框架

----

- 语义化

> 无论在系统的哪个部分，都避免取无意义的，或者容易发生混淆的名称。

- 简短

> 在满足语义化的前提下，尽量缩短名字的长度，使用容易理解的缩写，以及基本的常用英文单词。避免使用生僻词和过长的词。

- 程序中如果有缩写的话，全大写。

> 比如OK不要写成Ok。

- 严格禁止使用拼音命名！

## 数据库

- 在数据库中涉及到命名时一律用全小写，单词之间用下划线分隔。

使用以下格式：

    模块标识_对象类型_对象标识

例如`base_t_user`，`base_v_user`。

- 不要使用复数形式，例如上面的表不要起名为`base_t_users`。

- 用`t`表达表，用`v`表达视图，特殊地，`tj`表明这是一张关联表，`j`代表join，`ti`表明这是一张接口表，`i`代表interface。

所有的表都默认添加三个字段：

- `is_deleted` 布尔类型 默认 false
- `create_time` 时间戳类型 默认 now()
- `modify_time` 时间戳类型 默认 now()

主键统一命名为`id`。

所有布尔类型的字段，统一用`is_`开头。例如`is_deleted`。布尔类型字段用于只有两个待选值的场景。

所有枚举类型的字段，统一用`enum_`开头。例如`enum_state`。枚举类型字段用于多于两个待选值的场景。

所有json类型的字段，统一用`_json`结尾。因为在程序中将表现为string类型，需要在名称上显示出来该数据本身是json格式。

所有时间戳类型的字段，统一用`_time`结尾。

所有日期类型的字段，统一用`_date`结尾。

所有表达“总数”的字段，统一用`_total`结尾。

所有外键关联的字段，统一用`_id`结尾。

所有varchar类型字段，根据实际需要给定范围。

能给默认值的字段，一定要给默认值。比如布尔类型，创建日期等。

原则上非空或者不能重复的字段，要配置好相应约束。

## java程序

### java bean

如果对象中有一个字段是整数，那么在java程序中和数据库中，如果没有特殊场景要求，该字段的类型默认使用Integer，避免使用long，short等。

原因如下代码:

    int b = a + 1;

使用取值范围小于int的类型将报编译错误，不得不强转，因为程序中所有出现的数字常量，比如这里的1，都被认为是int。如果上述代码使用short则必须写成如下：

    short b = (short) (a + 1);

对象中的字段使用包装类型，如Integer，Boolean等，避免使用简单类型，因为查询结果可能是null。

### 方法

一个方法只做一件事情，如果命名时候出现“做某件事and某件事”，就说明方法需要拆分。

方法使用动词开头。但是要尽量避免使用`get`和`set`开头，因为这样容易与属性访问器混淆。

方法尽量不超过50行，否则要尝试重构。

一般情况下，方法应该尽量有一个返回值而不使用void。

原则上，if后面一定要接else。

### PO,VO,DTO

- PO用于映射数据表，与数据库表对象严格一一对应，属性与表字段严格一一对应。
- VO用于封装查询结果集，根据查询复杂程度，内部可能有集合等复杂类型成员变量。VO本身不严格对应某张表，VO的字段也不严格映射表的字段。VO中禁止出现查询条件。
- DTO用于封装查询参数，此类对象更多地服务于程序本身，可能封装一些跟数据库无关但是跟业务相关的参数，根据查询场景不同，也会封装分页参数。DTO中禁止出现结果集。

### 常量类和工具类

常量类要将构造方法私有化，并在类名上加`final`前缀。内部的常量字段全部加`public static final`前缀。

工具类分两种，一种是以`tool`结尾，这种工具类更接近业务逻辑，依赖除JDK以外的包。一种是以`util`结尾，这种工具类更接近底层算法，除了JDK没有其他任何依赖。

### DAO和service层

DAO层方法中，如果参数达到四个或者四个以上，就封装成dto传入，反之则使用`@Param`注解。（使用mybatis时）。

参数应该体现在方法名称上，使用`By...And...And...`的形式。前后顺序最好与参数列表中的顺序一致。这种命名可能导致函数名显得很长，但是更加语义化。

方法前缀：

返回一条结果：`selectOne`

返回多条结果：`selectList`

返回全部结果：`selectAll`

返回count：`count`

新增：`insert`

修改：`update`

假删除：`delete`

update，insert，delete方法的返回值使用int，不要用void。

在DAO层中保持以上命名规则，在命名时，更多地使用SQL语言中的动词，以清楚地表明该方法直接操作了数据库，相对的，在业务层中避免使用以上的方法开头，也避免使用SQL语言中的关键字，而应该倾向于体现业务逻辑。如：

返回一条结果：`queryOne`

返回多条结果：`queryList`

返回全部结果：`queryAll`

返回count：`count`

新增：`save`

修改：`modify`

假删除：`remove`

在程序中，如果需要在远端获取数据，比如调用api返回等，使用`pull`开头，表明从远端“拉取”数据。

## REST url设计

在**保证语义化**的基础上，尽量简化单词，隐藏原有意义，避免暴露逻辑。

模块自身的业务接口统一以`/m`开头

公用的API数据接口统一以`/a`开头

后续逐级细分功能，如

    /m/cross/book

表明是一个模块，是模块当中的图书漂流，是图书漂流中的图书管理功能。

但以上url应该继续修正为：`/m/c/b`或者`/m/b_c/b`这种形式，这样能避免用户从url中猜出业务逻辑。

REST风格要求在url上不体现操作动作，而全部使用名词来指定资源，在请求中指定操作动作，但实际应用中达不到这样的标准。所以建议统一用CRUD来代表增删改查四种操作，对于开发人员有足够的语义，对于用户也能起到足够的混淆。比如这样：

    /m/c/b/r/{bookId}

即代表根据bookId读取一条记录。

同样是查询，可能根据不同需求有多种实现，这时可以用数字划分，比如：

    /m/c/b/r/1/{groupId}

即根据套系查询书籍。

尽量避免在url上提供参数，url上能提供的参数只应该有id，且只能有一个，即**通过get请求，并将参数拼接在url上返回的场景，只能是单主键查询**。其他的操作统一使用post请求。这样可以保持url的短小简洁。

## 单路单例配置

配置功能应该有且仅有一种途径可以访问到。同样功能的配置只能有一处。

比如某些配置需要有前台页面展示，让管理员可以修改，那么这些配置放在数据库中，绝对禁止同时放在配置文件中，只能从http协议通过url访问配置功能。

而如果某些配置放在properties等类似配置文件中，那么绝对禁止通过某个页面访问修改，而只能以远程访问修改文档的方式修改。

这样的原则避免二义性，使得配置有且仅有一个，也避免多处配置同步的问题。

## 主键有效原则

操作数据时，比如更新，删除等，默认只提供根据主键操作的接口，即一般情况下，如果不知道某行数据的主键的话，将不能对其进行操作。