# 西辛小学数字校园——图书漂流

此程序是“西辛小学数字校园”项目中“图书漂流”的后端实现。

## 功能、边界与依赖

### 功能

此程序应负责实现图书漂流的所有业务逻辑，并负责维护相关数据。具体功能见API列表。

### 边界

此程序不负责以下功能：

- 基础数据的维护及相关逻辑的实现
- 组织架构的维护及相关逻辑的实现
- 全局通知的相关逻辑实现
- 登录的相关逻辑实现

### 依赖

- 全系统公用领域模型
- 登录中心
- 消息中心
- 基础信息管理

## 整体架构

## 实现方案

## 图书漂流API

### 管理员

#### 配置管理

- 修改默认配置项，每次漂流流程默认继承这个配置项。该配置项在系统中有默认值，管理员不想麻烦可以不用配。

> 目前想到的默认配置项有：
>
> - 周几开始轮转
> - 轮转方向顺时针？逆时针？
> - 是否自动暂停？即某一次轮转时发现上次轮转的记录都处于未开始的状态，这时怀疑出现了某种意外情况导致活动被打断，比如放假，但是管理员忘记了手动暂停，这时根据配置可以自动暂停当前活动流程。
> - 待添加。。。。

#### 漂流流程管理
- ~~新建流程，在此过程中分配年级和套系~~
- ~~修改流程信息~~
- ~~修改流程状态，比如暂停某个流程~~
- ~~批量修改流程状态，比如一键开始所有流程~~

#### 图书和套系管理

- ~~新增图书~~
- ~~根据id查询图书信息~~
- ~~根据名称查询图书信息~~
- ~~修改图书信息~~
- ~~追加或减少图书库存量~~
- ~~删除图书信息~~

- ~~新增套系~~
- ~~修改套系信息~~
- ~~向套系中追加图书~~
- ~~从套系中移除图书~~
- ~~删除套系信息~~

- ~~excel上传图书~~
- ~~excel上传套系~~
- ~~图书excel模板下载~~
- ~~套系excel模板下载~~

### 教师

- 查看当前轮转，本班的借书单
- *查看往期轮转，本班的借书单（待定，该功能主要用于还书，但是还书建议设计为统一页面）*
- 改变借书单的状态为借出，该操作标志着本班本次流转正式开始，现实中老师会在此时发书
- 改变借书单的状态为正常还回原书，该操作发生在计划收书时间
- 改变借书单的状态为正常但是还回了一本新书，该操作发生在计划收书时间
- 新增图书，一旦涉及到有新书，则新增，如有同名，则默认追加库存和流转量

如果学生过期还书：

- 查看本次图书漂流活动中，本班内所有异常记录，分为两种情况，
    - 一种是未还，即学生借了书但是无论原书新书都没有还，

    - 一种是历史，记录哪些学生异常还书，包括还书晚了或者丢了，但是历史中的都是已经处理完的记录，即学生要么还回了原书，要么还了新书。
- 异常处理，即在所有记录中处理未还记录
    - 改变借书单的状态为过期还原书
    - 改变借书单的状态为过期还新书
    - 新增图书，如果还的是新书的话


